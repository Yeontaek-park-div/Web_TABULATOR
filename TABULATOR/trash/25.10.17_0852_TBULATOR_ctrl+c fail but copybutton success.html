<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>Tabulator ë°”ë‹ë¼ ì˜ˆì‹œ</title>

  <!-- Tabulator CSS (CDN)
       â€» íŠ¹ì • ë²„ì „ì„ ê³ ì •í•˜ë ¤ë©´ @6.xì²˜ëŸ¼ ì§€ì • -->
  <link href="https://unpkg.com/tabulator-tables@latest/dist/css/tabulator.min.css" rel="stylesheet">

  <style>
    /* ë°ëª¨ìš© ìµœì†Œ ìŠ¤íƒ€ì¼ */
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 24px; }
    .toolbar { display:flex; gap:8px; margin-bottom:12px; flex-wrap: wrap; }
    #table { height: 420px; } /* ê³ ì • ë†’ì´: ê°€ìƒ ìŠ¤í¬ë¡¤ í™œì„±í™” */
    .note { color:#555; font-size: 13px; margin-top: 8px; }
    .search { width: 220px; padding: 6px 8px; }
    button { padding: 6px 10px; border:1px solid #ddd; background:#f7f7f7; border-radius:6px; cursor:pointer; }
    button:hover { background:#eee; }
  </style>
</head>
<body>

  <h1>Tabulator ë°”ë‹ë¼ JS ì˜ˆì‹œ</h1>

  <div class="toolbar">
    <!-- ê²€ìƒ‰ ì…ë ¥ -->
    <input id="search" class="search" type="text" placeholder="ì´ë¦„/ë„ì‹œ ê²€ìƒ‰ (ì‹¤ì‹œê°„ í•„í„°)" />

    <!-- í–‰ ì¡°ì‘ -->
    <button id="add-row">í–‰ ì¶”ê°€</button>
    <button id="del-row">ì„ íƒ í–‰ ì‚­ì œ</button>

    <!-- í´ë¦½ë³´ë“œ ì œì–´ -->
    <button id="copy">ì„ íƒ ì˜ì—­ ë³µì‚¬</button>
    <button id="paste">ë¶™ì—¬ë„£ê¸° ì‹œì‘(ì…€ í¬ì»¤ìŠ¤)</button>

    <!-- ë‚´ë³´ë‚´ê¸° -->
    <button id="export-csv">CSV ë‚´ë³´ë‚´ê¸°</button>
  </div>

  <!-- í…Œì´ë¸” ì»¨í…Œì´ë„ˆ
       â€» í¬ì»¤ìŠ¤ ê°€ëŠ¥í•˜ë©´ Ctrl+C ê¸°ë³¸ ì²˜ë¦¬ì— ìœ ë¦¬í•˜ì§€ë§Œ í•„ìˆ˜ëŠ” ì•„ë‹˜ -->
  <div id="table" tabindex="0"></div>
  <div class="note">
    Tip: ë§ˆìš°ìŠ¤ë¡œ ì…€ì„ ë“œë˜ê·¸í•´ ë²”ìœ„ë¥¼ ì„ íƒí•œ ë’¤ <b>Ctrl+C</b>ë¡œ ë³µì‚¬í•˜ì—¬ ì—‘ì…€/ë©”ëª¨ì¥ ë“±ì— ë¶™ì—¬ë„£ê¸° í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    (ë¸Œë¼ìš°ì € ë³´ì•ˆìƒ <b>file://</b>ì´ ì•„ë‹Œ <b>http(s)</b> í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸í•´ ì£¼ì„¸ìš”)
  </div>

  <!-- Tabulator JS (CDN) -->
  <script src="https://unpkg.com/tabulator-tables@latest/dist/js/tabulator.min.js"></script>

  <script>
    // ---------------------------
    // ë°ëª¨ìš© ì´ˆê¸° ë°ì´í„°
    // ---------------------------
    const tableData = [
      { id:1, name:"í™ê¸¸ë™", age:29, city:"ì„œìš¸", join:"2024-10-01", score: 83 },
      { id:2, name:"ê¹€ì•„ë¦„", age:32, city:"ë¶€ì‚°", join:"2023-07-12", score: 91 },
      { id:3, name:"ì´ì¤€í˜¸", age:26, city:"ëŒ€êµ¬", join:"2025-01-10", score: 75 },
      { id:4, name:"ë°•ì§€ë¯¼", age:41, city:"ì¸ì²œ", join:"2022-03-30", score: 88 },
    ];

    // ---------------------------
    // Tabulator ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
    // ---------------------------
    const table = new Tabulator("#table", {
      // ê¸°ë³¸ ë°ì´í„°/í‚¤
      data: tableData,            // ì´ˆê¸° ë°ì´í„°
      index: "id",                // ê° í–‰ì˜ ê³ ìœ í‚¤(ì¤‘ë³µX)

      // ë ˆì´ì•„ì›ƒ/í–‰ë†’ì´
      layout: "fitColumns",       // ì»¬ëŸ¼ ë„ˆë¹„ ìë™ë§ì¶¤
      height: "420px",            // ê°€ìƒ ìŠ¤í¬ë¡¤
      selectable: true,           // í–‰ ì„ íƒ ê°€ëŠ¥(í–‰ ì‚­ì œ ë“±ì— ì‚¬ìš©)

      // ìƒí˜¸ì‘ìš© ê¸°ë³¸ ì˜µì…˜
      movableColumns: true,       // ì»¬ëŸ¼ ë“œë˜ê·¸ë¡œ ìˆœì„œë³€ê²½
      resizableRows: true,        // í–‰ë†’ì´ ì¡°ì ˆ

      // âœ… í´ë¦½ë³´ë“œ & ë²”ìœ„ ì„ íƒ (ì—¬ëŸ¬ ì…€ ë³µì‚¬ìš©)
      clipboard: true,                 // Tabulator í´ë¦½ë³´ë“œ ëª¨ë“ˆ í™œì„±í™”
      clipboardPasteAction: "update",  // ë¶™ì—¬ë„£ê¸° ì‹œ ê¸°ì¡´ ì…€ ì—…ë°ì´íŠ¸
      selectableRange: true,           // ë§ˆìš°ìŠ¤ ë“œë˜ê·¸ë¡œ ì…€ ë²”ìœ„ ì„ íƒ
      selectableRangeMode: "cell",     // ì„ íƒ ë‹¨ìœ„ë¥¼ 'ì…€'ë¡œ ê³ ì •
      selectableRangeRows: true,       // í–‰ ë‹¨ìœ„ ë“œë˜ê·¸ í—ˆìš©(ì„ íƒ í¸ì˜)
      selectableRangeColumns: true,    // ì»¬ëŸ¼ ë‹¨ìœ„ ë“œë˜ê·¸ í—ˆìš©(ì„ íƒ í¸ì˜)

      // (ì„ íƒ) ë³µì‚¬ ì‹œ í—¤ë” í¬í•¨ ë“± ìƒì„¸ ì„¤ì •
      clipboardCopyConfig: {
        columnHeaders: false,   // trueë©´ ì²« í–‰ì— ì»¬ëŸ¼í—¤ë” ì¶”ê°€
        rowHeaders: false,
        columnGroups: false,
      },

      // ì»¬ëŸ¼ ì •ì˜
      columns: [
        { title:"ID", field:"id", width:70, headerSort:true, editor:"input" },
        { title:"ì´ë¦„", field:"name", width:80, headerSort:true, editor:"input" },
        { title:"ë‚˜ì´", field:"age", width:80, hozAlign:"right", editor:"number",
          validator:[{ type:"min", parameters:18 }, { type:"max", parameters:120 }],
        },
        { title:"ë„ì‹œ", field:"city", width:70, headerSort:true, editor:"input" },
        { title:"ì…ì‚¬ì¼", field:"join", width:70, editor:"input",
          // ê°„ë‹¨ ë‚ ì§œ í¬ë§· ê²€ì¦(YYYY-MM-DD)
          validator: (cell, value) => /^\d{4}-\d{2}-\d{2}$/.test(value) || value === "",
        },
        { title:"ì ìˆ˜", field:"score", width:90, hozAlign:"right", editor:"number",
          formatter: (cell) => {
            // ì ìˆ˜ì— ë”°ë¼ ë¼ë²¨ë§(ì˜ˆ: 90ì´ìƒ ìš°ìˆ˜)
            const v = Number(cell.getValue());
            if (Number.isNaN(v)) return "";
            if (v >= 90) return `â­ ${v}`;
            if (v >= 80) return `ğŸ‘ ${v}`;
            return `${v}`;
          },
        },
      ],
    });

    // ---------------------------
    // âŒ (ì¤‘ìš”) Ctrl+C ê°€ë¡œì±„ëŠ” keydown í•¸ë“¤ëŸ¬ë¥¼ ë‘ì§€ ì•ŠìŠµë‹ˆë‹¤.
    // Tabulatorê°€ ìì²´ì ìœ¼ë¡œ ì…€ ë²”ìœ„ ì„ íƒ + Ctrl/Cmd+Cë¥¼ ì²˜ë¦¬í•´
    // ì‹œìŠ¤í…œ í´ë¦½ë³´ë“œì— 'í…ìŠ¤íŠ¸'ë¡œ ë„£ì–´ì¤ë‹ˆë‹¤.
    // ---------------------------

    // ---------------------------
    // íˆ´ë°”: ê²€ìƒ‰(ì‹¤ì‹œê°„ í•„í„°)
    // ---------------------------
    const $search = document.getElementById("search");
    $search.addEventListener("input", () => {
      const query = $search.value.trim();
      if (!query) {
        table.clearFilter(); // ê²€ìƒ‰ì–´ ì—†ìœ¼ë©´ í•„í„° í•´ì œ
      } else {
        // ì´ë¦„/ë„ì‹œ ì»¬ëŸ¼ OR í•„í„° (ë¶€ë¶„ì¼ì¹˜)
        table.setFilter([
          [
            { field:"name", type:"like", value:query },
            { field:"city", type:"like", value:query },
          ]
        ]);
      }
    });

    // ---------------------------
    // íˆ´ë°”: í–‰ ì¶”ê°€/ì‚­ì œ
    // ---------------------------
    document.getElementById("add-row").addEventListener("click", () => {
      // ìƒˆ í–‰ ê¸°ë³¸ê°’ ì˜ˆì‹œ(í•„ìš” ì‹œ ë³€ê²½)
      const newId = Date.now(); // ê°„ë‹¨ ìœ ë‹ˆí¬ ID
      table.addRow({ id:newId, name:"", age:null, city:"", join:"", score:null }, true);
    });

    document.getElementById("del-row").addEventListener("click", () => {
      const selected = table.getSelectedRows();
      if (selected.length === 0) {
        alert("ì‚­ì œí•  í–‰ì„ ì„ íƒí•˜ì„¸ìš”.");
        return;
      }
      selected.forEach(r => r.delete());
    });

    // ---------------------------
    // íˆ´ë°”: í´ë¦½ë³´ë“œ
    // ---------------------------
    document.getElementById("copy").addEventListener("click", () => {
      // ë²„íŠ¼ í´ë¦­ë„ ì‚¬ìš©ì ì œìŠ¤ì²˜ì´ë¯€ë¡œ ì•ˆì „í•˜ê²Œ ë³µì‚¬ ê°€ëŠ¥
      // Tabulatorê°€ ì„ íƒ ë²”ìœ„ê°€ ìˆìœ¼ë©´ ë²”ìœ„ í…ìŠ¤íŠ¸ë¥¼ ë³µì‚¬í•©ë‹ˆë‹¤.
      table.copyToClipboard(); // ì¸ì ì—†ì´ í˜¸ì¶œ -> Tabulatorê°€ ì•Œì•„ì„œ ì²˜ë¦¬
    });

    document.getElementById("paste").addEventListener("click", () => {
      // ë¶™ì—¬ë„£ê¸° ì•ˆë‚´: ì…€ì„ í•œë²ˆ í´ë¦­í•˜ê³  Ctrl+V
      alert("ë¶™ì—¬ë„£ê¸°ë¥¼ í•˜ë ¤ë©´ ì…€ì„ í´ë¦­í•˜ê³  Ctrl+Vë¥¼ ëˆ„ë¥´ì„¸ìš”.");
    });

    // ---------------------------
    // íˆ´ë°”: CSV ë‚´ë³´ë‚´ê¸°
    // ---------------------------
    document.getElementById("export-csv").addEventListener("click", () => {
      // í˜„ì¬ ê·¸ë¦¬ë“œ ë°ì´í„°ë¥¼ CSVë¡œ ë‹¤ìš´ë¡œë“œ
      table.download("csv", "table-export.csv");
      // ì°¸ê³ ) XLSX ë‚´ë³´ë‚´ê¸°ëŠ” sheetjs(xlsx) ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€ë¡œ ë¡œë“œí•´ì•¼ í•©ë‹ˆë‹¤.
    });

    // ---------------------------
    // ì…€ í¸ì§‘ ì½œë°±(ë¡œê¹…/ê²€ì¦ í”¼ë“œë°± ì˜ˆì‹œ)
    // ---------------------------
    table.on("cellEdited", (cell) => {
      const field = cell.getField();
      const value = cell.getValue();
      // ì˜ˆ: ë‚˜ì´/ì ìˆ˜ ìˆ«ì ê²€ì¦ ì¶”ê°€ ë©”ì‹œì§€
      if ((field === "age" || field === "score") && value !== null && value !== "" && isNaN(Number(value))) {
        alert(`'${field}'ì—ëŠ” ìˆ«ìë§Œ ì…ë ¥í•˜ì„¸ìš”.`);
        cell.restoreOldValue(); // ì´ì „ ê°’ìœ¼ë¡œ ë˜ëŒë¦¼
      }
    });
  </script>
</body>
</html>
