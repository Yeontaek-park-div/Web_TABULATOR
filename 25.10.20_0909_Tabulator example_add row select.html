<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>Tabulator: rowAdded로 _rid 자동생성</title>

  <!-- ✅ Tabulator CSS (최신 버전 불러오기)
       - 표의 기본 스타일을 적용 -->
  <link href="https://unpkg.com/tabulator-tables@latest/dist/css/tabulator.min.css" rel="stylesheet">

  <style>
    /* ✅ 페이지 기본 스타일 */
    body { 
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; 
      margin: 24px; 
    }

    /* 툴바 영역(추가 버튼 등)을 위한 기본 레이아웃 - 현재는 사용 안 함 */
    .toolbar { 
      display:flex; 
      gap:8px; 
      margin-bottom:12px; 
      flex-wrap: wrap; 
    }

    /* ✅ 표 영역 크기 지정 */
    #table { height: 420px; }

    /* ✅ 버튼 스타일 (추후 추가 버튼 등을 위한 공통 스타일) */
    button { 
      padding: 6px 10px; 
      border:1px solid #ddd; 
      background:#f7f7f7; 
      border-radius:6px; 
      cursor:pointer; 
    }

    button:hover { background:#eee; }
  </style>
</head>

<body>

  <h1>Tabulator Example</h1>

  <!-- ✅ Tabulator가 렌더링될 영역 -->
  <div id="table" tabindex="0"></div>

  <!-- ✅ Tabulator JS (최신 버전 불러오기)
       - Tabulator 클래스를 전역에 등록 -->
  <script src="https://unpkg.com/tabulator-tables@latest/dist/js/tabulator.min.js"></script>

  <script>
    // ✅ 1. 초기 데이터 정의
    // 각 행은 객체 형태로, field 이름과 동일한 키를 가짐
    const tableData = [
      { name:"홍길동", age:"29", city:"서울",   join:"2024-10-01", score:"83" },
      { name:"김아름", age:"32", city:"부산",   join:"2023-07-12", score:"91" },
      { name:"이준호", age:"26", city:"대구",   join:"2025-01-10", score:"75" },
      { name:"박지민", age:"41", city:"인천",   join:"2022-03-30", score:"88" },
    ];

    // ✅ 2. Tabulator 테이블 생성
    const table = new Tabulator("#table", {
      data: tableData,           // 표시할 초기 데이터
      layout: "fitColumns",      // 열 너비를 전체 폭에 맞게 자동 조정
      height: "420px",           // 테이블 높이 지정

      // ✅ 행 선택 기능
      rowHeader: {
        formatter: "rownum",  // Tabulator 내장 포매터 중 하나로, 각 행의 번호(1부터 시작)를 자동으로 표시합니다.
        headerSort: false,    // 이 열의 헤더를 클릭해도 정렬되지 않게 함. 보통 행 번호는 정렬 기능이 불필요하므로 false로 설정
        hozAlign: "center",   // 열 안의 텍스트(번호)를 수평 중앙 정렬
        resizable: false,     // 사용자가 마우스로 이 열의 너비를 조정할 수 없게 함
        frozen: true          // 스크롤 시에도 이 열은 항상 왼쪽에 고정되도록 함 (엑셀의 “틀 고정”과 비슷)
      },
      selectable: true,          // 단일 행 선택
      selectableRange: true,     // 마우스로 드래그하여 여러 행/셀 범위 선택 가능

      // ✅ 사용자 편의 기능
      movableColumns: true,      // 열 순서 변경 가능 (드래그)
      resizableRows: true,       // 행 높이 조정 가능

      // ✅ 클립보드 기능
      clipboard: true,                // 복사/붙여넣기 활성화 (Ctrl+C / Ctrl+V)
      clipboardPasteAction: "range",  // 붙여넣기 시 기존 셀 값 덮어쓰기
      clipboardCopyRowRange: "range", // 선택된 셀 범위를 클립보드 대상으로 지정
      clipboardPasteParser: "range",  // 범위 붙여넣기까지 쓸 거면 함께 권장
      clipboardCopyConfig: {
        rowHeaders: false,      // 복사 시 행 번호 포함 여부
        columnHeaders: false,   // 복사 시 열 제목 포함 여부
      },

      // Tabulator의 클립보드 기본 로직은:
      //  1.범위 선택이 있으면 → 범위를 복사
      //  2.범위 선택이 없고 행 선택이 있으면 → 선택된 행 전체를 복사라는 우선순위를 가집니다.


      // ✅ 셀 수정 방식
      editTriggerEvent: "dblclick",   // 더블클릭 시 편집 모드 진입

      // ✅ 열 정의
      columns: [
        { title:"이름", field:"name", editor:"input" },  // 텍스트 편집 가능
        { title:"나이", field:"age",  width:90, editor:"input" },
        { title:"도시", field:"city", editor:"input" },
        { title:"입사일", field:"join", editor:"input" },
        { title:"점수", field:"score", width:90, editor:"input" },
      ],
    });

    // ✅ 3. 디버깅 이벤트


    // ✅ 다중 선택 UX: Ctrl/Shift + rowHeader 클릭
    let anchorPos = null;     // 마지막 기준점(Shift 구간 선택용)
    let headerDrag = null;    // 드래그 범위 선택 상태

    // ✅ Ctrl/Shift + rowHeader 클릭 처리
    table.on("cellClick", (e, cell) => {
      const col = cell.getColumn();
      if (!col.getField()) {            // 행 헤더에서만
        const row = cell.getRow();
        const pos = row.getPosition();

        if (e.shiftKey && anchorPos !== null) {
          // Shift: 앵커~현재 구간 선택 (기존 선택 초기화)
          const [lo, hi] = pos < anchorPos ? [pos, anchorPos] : [anchorPos, pos];
          table.deselectRow();
          table.getRows().forEach(r => {
            const p = r.getPosition();
            if (p >= lo && p <= hi) r.select();
          });
        } else if (e.ctrlKey || e.metaKey) {
          // Ctrl/Cmd: 토글 (기존 선택 유지)
          if (row.isSelected()) row.deselect();
          else row.select();
          anchorPos = pos;  // 다음 Shift 범위를 위해 기준 갱신
        } else {
          // 단일 클릭: 단일 선택
          table.deselectRow();
          row.select();         // 실제로 선택하여 UI에 표기
          anchorPos = pos;
        }
      }
    });





  </script>
</body>
</html>
