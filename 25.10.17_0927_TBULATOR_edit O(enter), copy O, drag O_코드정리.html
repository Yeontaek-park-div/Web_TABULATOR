<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>Tabulator ë°”ë‹ë¼ ì˜ˆì‹œ (ì •ë¦¬ë³¸)</title>

  <!-- Tabulator CSS (CDN)
       â€» ìµœì‹  ë²„ì „. íŠ¹ì • ë²„ì „ì„ ê³ ì •í•˜ë ¤ë©´ @6.x ì²˜ëŸ¼ ì§€ì •í•˜ì„¸ìš”. -->
  <link href="https://unpkg.com/tabulator-tables@latest/dist/css/tabulator.min.css" rel="stylesheet">

  <style>
    /* ===== ìµœì†Œ ìŠ¤íƒ€ì¼ ===== */
    :root { --gap: 8px; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 24px; }
    .toolbar { display:flex; gap:var(--gap); margin-bottom:12px; flex-wrap: wrap; }
    #table { height: 420px; } /* ê³ ì • ë†’ì´: ê°€ìƒ ìŠ¤í¬ë¡¤ */
    .note { color:#555; font-size: 13px; margin-top: 8px; }
    .search { width: 220px; padding: 6px 8px; }
    button { padding: 6px 10px; border:1px solid #ddd; background:#f7f7f7; border-radius:6px; cursor:pointer; }
    button:hover { background:#eee; }
  </style>
</head>
<body>

  <h1>Tabulator ë°”ë‹ë¼ JS ì˜ˆì‹œ</h1>

  <!-- ===== íˆ´ë°” ===== -->
  <div class="toolbar" role="toolbar" aria-label="í…Œì´ë¸” ë„êµ¬ ë§‰ëŒ€">
    <!-- ê²€ìƒ‰ ì…ë ¥ -->
    <input id="search" class="search" type="text" placeholder="ì´ë¦„/ë„ì‹œ ê²€ìƒ‰ (ì‹¤ì‹œê°„ í•„í„°)" aria-label="ì´ë¦„ ë˜ëŠ” ë„ì‹œ ê²€ìƒ‰" />

    <!-- í–‰ ì¡°ì‘ -->
    <button id="add-row" type="button">í–‰ ì¶”ê°€</button>
    <button id="del-row" type="button">ì„ íƒ í–‰ ì‚­ì œ</button>

    <!-- í´ë¦½ë³´ë“œ ì œì–´ -->
    <button id="copy" type="button">ì„ íƒ ì˜ì—­ ë³µì‚¬</button>
    <button id="paste" type="button">ë¶™ì—¬ë„£ê¸° ì•ˆë‚´</button>

    <!-- ë‚´ë³´ë‚´ê¸° -->
    <button id="export-csv" type="button">CSV ë‚´ë³´ë‚´ê¸°</button>
  </div>

  <!-- ===== í…Œì´ë¸” ì»¨í…Œì´ë„ˆ ===== -->
  <div id="table" tabindex="0" aria-label="ë°ì´í„° í…Œì´ë¸”"></div>
  <div class="note">
    Tip: ë§ˆìš°ìŠ¤ë¡œ ì…€ì„ ë“œë˜ê·¸í•´ ë²”ìœ„ë¥¼ ì„ íƒí•œ ë’¤ <b>Ctrl+C</b>ë¡œ ë³µì‚¬í•˜ì—¬ ì—‘ì…€/ë©”ëª¨ì¥ ë“±ì— ë¶™ì—¬ë„£ê¸° í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  </div>

  <!-- Tabulator JS (CDN) -->
  <script src="https://unpkg.com/tabulator-tables@latest/dist/js/tabulator.min.js"></script>

  <script>
    // =========================
    // 1) ë°ì´í„°/ì»¬ëŸ¼/ì˜µì…˜ ì •ì˜
    // =========================

    /* ë°ëª¨ìš© ì´ˆê¸° ë°ì´í„° */
    const DATA = [
      { id:1, name:"í™ê¸¸ë™", age:29, city:"ì„œìš¸", join:"2024-10-01", score:83 },
      { id:2, name:"ê¹€ì•„ë¦„", age:32, city:"ë¶€ì‚°", join:"2023-07-12", score:91 },
      { id:3, name:"ì´ì¤€í˜¸", age:26, city:"ëŒ€êµ¬", join:"2025-01-10", score:75 },
      { id:4, name:"ë°•ì§€ë¯¼", age:41, city:"ì¸ì²œ", join:"2022-03-30", score:88 },
    ];

    /* ì»¬ëŸ¼ ì •ì˜ */
    const COLUMNS = [
      { title:"ID", field:"id", width:70, headerSort:true, editor:"input" },
      { title:"ì´ë¦„", field:"name", width:80, headerSort:true, editor:"input" },
      {
        title:"ë‚˜ì´", field:"age", width:80, hozAlign:"right", editor:"number",
        // ìˆ«ì ë²”ìœ„ ê²€ì¦ (18~120)
        validator: [{ type:"min", parameters:18 }, { type:"max", parameters:120 }],
      },
      { title:"ë„ì‹œ", field:"city", width:70, headerSort:true, editor:"input" },
      {
        title:"ì…ì‚¬ì¼", field:"join", width:90, editor:"input",
        // ê°„ë‹¨ ë‚ ì§œ í¬ë§· ê²€ì¦(YYYY-MM-DD) â€” ë¹ˆ ê°’ì€ í—ˆìš©
        validator: (cell, value) => /^\d{4}-\d{2}-\d{2}$/.test(value) || value === "",
      },
      {
        title:"ì ìˆ˜", field:"score", width:90, hozAlign:"right", editor:"number",
        // ì ìˆ˜ ë¼ë²¨ë§(â˜…, ğŸ‘) â€” ë³´ê¸° í¸ì˜ìš©
        formatter: (cell) => {
          const v = Number(cell.getValue());
          if (Number.isNaN(v)) return "";
          if (v >= 90) return `â­ ${v}`;
          if (v >= 80) return `ğŸ‘ ${v}`;
          return `${v}`;
        },
      },
    ];

    /* Tabulator ì˜µì…˜ */
    const OPTIONS = {
      data: DATA,                 // ì´ˆê¸° ë°ì´í„°
      index: "id",                // ê° í–‰ì˜ ê³ ìœ í‚¤(ì¤‘ë³µX)
      layout: "fitColumns",       // ì»¬ëŸ¼ ë„ˆë¹„ ìë™ë§ì¶¤
      height: "420px",            // ê°€ìƒ ìŠ¤í¬ë¡¤
      selectable: true,           // í–‰ ì„ íƒ ê°€ëŠ¥(í–‰ ì‚­ì œ ë“±ì— ì‚¬ìš©)
      movableColumns: true,       // ì»¬ëŸ¼ ë“œë˜ê·¸ë¡œ ìˆœì„œë³€ê²½
      resizableRows: true,        // í–‰ë†’ì´ ì¡°ì ˆ

      // âœ… í´ë¦½ë³´ë“œ & ë²”ìœ„ ì„ íƒ (ì—¬ëŸ¬ ì…€ ë³µì‚¬ìš©)
      clipboard: true,                 // í´ë¦½ë³´ë“œ ëª¨ë“ˆ í™œì„±í™”
      clipboardPasteAction: "update",  // ë¶™ì—¬ë„£ê¸° ì‹œ ê¸°ì¡´ ì…€ ì—…ë°ì´íŠ¸
      selectableRange: true,           // ë§ˆìš°ìŠ¤ ë“œë˜ê·¸ë¡œ ì…€ ë²”ìœ„ ì„ íƒ
      selectableRangeMode: "cell",     // ì„ íƒ ë‹¨ìœ„ë¥¼ 'ì…€'ë¡œ ê³ ì •
      selectableRangeRows: true,       // í–‰ ë‹¨ìœ„ ë“œë˜ê·¸ í—ˆìš©
      selectableRangeColumns: true,    // ì»¬ëŸ¼ ë‹¨ìœ„ ë“œë˜ê·¸ í—ˆìš©

      // ë³µì‚¬ ì‹œ í—¤ë” í¬í•¨ ë“± ìƒì„¸ ì„¤ì • (í•„ìš” ì‹œ ì¼œì„¸ìš”)
      clipboardCopyConfig: {
        columnHeaders: false,   // trueë©´ ì²« í–‰ì— ì»¬ëŸ¼í—¤ë” ì¶”ê°€
        rowHeaders: false,
        columnGroups: false,
      },
      columns: COLUMNS,
    };

    // =========================
    // 2) Tabulator ìƒì„±
    // =========================
    const table = new Tabulator("#table", OPTIONS);

    // =========================
    // 3) ìœ í‹¸ í•¨ìˆ˜
    // =========================

    /**
     * ì„ íƒëœ ì…€/í–‰ ë³µì‚¬ë¥¼ ì‹¤í–‰.
     * - ìµœì‹  TabulatorëŠ” "range" ë³µì‚¬ ì§€ì›.
     * - ë²„ì „/í™˜ê²½ì— ë”°ë¼ "range" ë¯¸ì§€ì› ì‹œ "selected"ë¡œ í´ë°±.
     */
    function copySelectedToClipboard() {
      try {
        table.copyToClipboard("range");     // ìš°ì„ : ì„ íƒ 'ì…€ ë²”ìœ„' ë³µì‚¬
      } catch (e) {
        table.copyToClipboard("selected");  // í´ë°±: ì„ íƒ 'í–‰' ë³µì‚¬
      }
    }

    /**
     * ì…ë ¥ ìš”ì†Œ í¸ì§‘ ì¤‘ ì—¬ë¶€ íŒë‹¨.
     * - í¸ì§‘ ì¤‘ì—ëŠ” Ctrl+C ê¸°ë³¸ ë™ì‘(í…ìŠ¤íŠ¸ ë³µì‚¬)ì„ ë°©í•´í•˜ì§€ ì•Šê¸° ìœ„í•¨.
     */
    function isEditingTarget(target) {
      if (!target) return false;
      const tag = target.tagName ? target.tagName.toLowerCase() : "";
      return tag === "input" || tag === "textarea" || target.isContentEditable;
    }

    /**
     * ê°„ë‹¨ ë””ë°”ìš´ìŠ¤ (ê²€ìƒ‰ ìµœì í™”)
     */
    function debounce(fn, delay = 150) {
      let t = null;
      return (...args) => {
        clearTimeout(t);
        t = setTimeout(() => fn.apply(null, args), delay);
      };
    }

    // =========================
    // 4) í‚¤ë³´ë“œ/ì´ë²¤íŠ¸ ë°”ì¸ë”©
    // =========================

    // Ctrl/Cmd + C => ë²”ìœ„ ë³µì‚¬ (í…Œì´ë¸” ì»¨í…Œì´ë„ˆê°€ í¬ì»¤ìŠ¤ ìƒíƒœì¼ ë•Œ)
    const tableEl = document.getElementById("table");
    tableEl.addEventListener("keydown", (ev) => {
      const isMac = navigator.platform.toUpperCase().includes("MAC");
      const ctrlOrCmd = isMac ? ev.metaKey : ev.ctrlKey;

      // í¸ì§‘ ì¤‘ì´ë©´ ê¸°ë³¸ ë™ì‘ ìœ ì§€ (ì…€ ì—ë””í„° ì…ë ¥ ë³µì‚¬)
      if (ctrlOrCmd && ev.key.toLowerCase() === "c" && !isEditingTarget(ev.target)) {
        ev.preventDefault();           // ê¸°ë³¸ ë³µì‚¬ ì°¨ë‹¨
        copySelectedToClipboard();     // ì»¤ìŠ¤í…€ ë³µì‚¬ ì‹¤í–‰
      }
    });

    // ê²€ìƒ‰(ì‹¤ì‹œê°„ OR í•„í„°) â€” ë””ë°”ìš´ìŠ¤ ì ìš©
    const searchInput = document.getElementById("search");
    searchInput.addEventListener("input", debounce(() => {
      const q = searchInput.value.trim();
      if (!q) {
        table.clearFilter();
      } else {
        // ì´ë¦„/ë„ì‹œ ì»¬ëŸ¼ OR í•„í„° (ë¶€ë¶„ì¼ì¹˜)
        table.setFilter([
          [
            { field:"name", type:"like", value:q },
            { field:"city", type:"like", value:q },
          ]
        ]);
      }
    }, 200));

    // í–‰ ì¶”ê°€
    document.getElementById("add-row").addEventListener("click", () => {
      // ê°„ë‹¨ ìœ ë‹ˆí¬ ID â€” ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ì„œë²„ ë°œê¸‰ IDë¥¼ ê¶Œì¥
      const newId = Date.now();
      table.addRow({ id:newId, name:"", age:null, city:"", join:"", score:null }, true);
    });

    // ì„ íƒ í–‰ ì‚­ì œ
    document.getElementById("del-row").addEventListener("click", () => {
      const selected = table.getSelectedRows();
      if (selected.length === 0) {
        alert("ì‚­ì œí•  í–‰ì„ ì„ íƒí•˜ì„¸ìš”.");
        return;
      }
      selected.forEach(r => r.delete());
    });

    // ì„ íƒ ì˜ì—­ ë³µì‚¬ (ë²„íŠ¼)
    document.getElementById("copy").addEventListener("click", () => {
      copySelectedToClipboard();
    });

    // ë¶™ì—¬ë„£ê¸° ì•ˆë‚´ (ë¶™ì—¬ë„£ê¸°ëŠ” ì…€ í¬ì»¤ìŠ¤ í›„ Ctrl+V)
    document.getElementById("paste").addEventListener("click", () => {
      alert("ë¶™ì—¬ë„£ê¸°ë¥¼ í•˜ë ¤ë©´ ì…€ì„ í•œë²ˆ í´ë¦­í•˜ê³  Ctrl+Vë¥¼ ëˆ„ë¥´ì„¸ìš”.");
    });

    // CSV ë‚´ë³´ë‚´ê¸°
    document.getElementById("export-csv").addEventListener("click", () => {
      table.download("csv", "table-export.csv");
      // ì°¸ê³ : XLSX ë‚´ë³´ë‚´ê¸°ëŠ” sheetjs(xlsx) ì¶”ê°€ ë¡œë“œ í•„ìš”
    });

    // ì…€ í¸ì§‘ ì½œë°±(ìˆ«ì ê²€ì¦ ë³´ì¡° ì•ˆë‚´)
    table.on("cellEdited", (cell) => {
      const field = cell.getField();
      const value = cell.getValue();

      // 'age', 'score'ëŠ” ìˆ«ìë§Œ í—ˆìš© â€” ìˆ«ì ì•„ë‹˜ì„ ì…ë ¥í–ˆì„ ë•Œ ë¡¤ë°±
      if ((field === "age" || field === "score") && value !== null && value !== "" && isNaN(Number(value))) {
        alert(`'${field}'ì—ëŠ” ìˆ«ìë§Œ ì…ë ¥í•˜ì„¸ìš”.`);
        cell.restoreOldValue();
      }
    });
  </script>
</body>
</html>
